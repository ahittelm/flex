<html>
<head>
	<title>Timer</title>	
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">


  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>	
    <link href="/css/bootstrap.css" rel="stylesheet">
	<link href="/css/index.css" rel="stylesheet">



	<nav class="navbar navbar-toggleable-md navbar-light" id="navigation">
	  	<div class="container-fluid">
	  		  <a id="title">flex</a>
			  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
			    <span class="navbar-toggler-icon"></span>
			  </button>
			  <div class="collapse navbar-collapse" id="navbarNav">
			    <ul class="navbar-nav">
			      <li class="nav-item active">
			        <a class="nav-link" href="../library"><font color="#651fff">Library</font><span class="sr-only">(current)</span></a>
			      </li>
			      <li class="nav-item">
			        <a class="nav-link" href="../stats">Stats</a>
			      </li>
			      <li class="nav-item">
			        <a class="nav-link" href="../Timer">Timer</a>
			      </li>
			<!--       <li class="nav-item">
			        <a class="nav-link" href="settings">Settings</a>
			      </li> -->
			    </ul>
			  </div>	
		</div>
	</nav>
</head>

<body>

<style>
p {
  text-align: center;
  font-size: 20px;
  margin-top:0px;
}
</style>
</head>

<body>
<script>
function cancel() {
	location.href = "library"
}
</script>
  
<!--  <form action="/custom">
{{#each workout.exercises}}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
	addExercise({{exname}}, {{time}}, {{unit}}, {{sound}})</script>
{{/each}}
</form>  -->
<p id="currexercise"><p>
<p id="currtime"></p>

<div id="outerProgressBar">
	<div id="innerProgressBar">		  
</div>

<button type="button" id="timerButtonPause" onclick="pause()" class="btn btn-secondary btn-lg">Pause</button>
<button type="button" id="timerButtonPlay" onclick="play()" style="display:none" class="btn btn-secondary btn-lg">Play</button>
<button type="button" id="timerButtonCancel" onclick="cancel()" class="btn btn-secondary btn-lg">Cancel</button>

<p id="upnext"></p>

<audio id="audio">
	<source id="audio" type="audio/mpeg">
</audio>

<!--START OF SCRIPT-->
<script>
window.onload = initialize();

// TIMERS
var index = -1;

var origtt = -1;
var currtt = origtt;
var min;
var sec; 
var increment = 1;
var lowbounds = -1;
var myVar;
var exercises;
var end = false;;


function initialize(){
	// var totalMin=0;
	// var totalSec=0;
	var exercises2 =[];
	// {{#each workout.exercises}}
	// 	totalMin+= {{this.min}};
	// 	totalSec+={{this.sec}};	
	// {{/each}}
	// totalMin += Math.trunc(totalSec/60);
	// totalSec = totalSec % 60;
	// orig = totalMin * 60 + totalSec;
	// val = orig;
	// myVar = setInterval(myTimer, 1000);
	{{#each workout.exercises}}
		var arr = [];
		arr.push("{{this.exname}}");
		arr.push({{this.min}});
		arr.push({{this.sec}});
		arr.push("{{this.sound}}");
		exercises2.push(arr);
	{{/each}}

	exercises = exercises2;

	myVar =  setInterval(myTimer, 1000)
}

function myTimer() {
	if(currtt == -1)
	{
		++index;

		if(index != 0)
		{
			playAudio();
		}
		if(index >= exercises.length)
		{
			end = true;
			clearTimeout(myVar);
		}
		else{
			min = exercises[index][1];
			sec = exercises[index][2];
			currtt = min * 60 + sec;
			origtt = currtt;
			animate();
		}

	}

    if(!end) {
    	/* setting the page */
    	document.getElementById("currexercise").innerHTML = "<b>" + exercises[index][0] + "</b>";



	    document.getElementById("currtime").innerHTML = "<b>" + min + "</b>" + " min " + "<b>" + sec + "</b>" + " s";

    	sec--
    	if(sec < 0)
    	{
    		sec = 59;
    		min--;
    		if(min < 0)
    			min = 0;
    	}
    	
	    //setting new exercises
	    var next ="";
	    for(var i = index + 1; i < exercises.length; i++)
	    {
	    	if(i == index+1)
	    	{
	    		next += "<b>Up Next: </b><br>";
	    	}
	    	next += "\t" + exercises[i][0] + "<br>";
	    }
	    if(next == "")
	    {
	  		document.getElementById("upnext").innerHTML = "<b>Final Exercise!</b>";
	  	}
	  	else
	  	{
	  		document.getElementById("upnext").innerHTML = next;
	  	}


	    /* updating time */
	  	currtt -= increment;
	    animate();
	}
	else{
		document.getElementById("upnext").innerHTML = "<b>Done!</b>";
		document.getElementById("timerButtonCancel").style.display = "none";
		document.getElementById("timerButtonPause").style.display = "none";
	}
}

function pause(){
	clearTimeout(myVar); 
	$("#timerButtonPlay").show();
	$("#timerButtonPause").hide();
}

function play(){
	myVar = setInterval(myTimer, 1000);
	$("#timerButtonPlay").hide();
	$("#timerButtonPause").show();	 
}

//ANIMATION
function animate(){
    $("#innerProgressBar").animate({
        width: (1-((currtt+1)/(origtt+1))) * 100 +'%'
    });
}



//audios
var audio = document.getElementById("audio"); 

function playAudio() { 
	document.getElementById("audio").src = "../audio/" + exercises[index-1][3] + ".mp3";
    audio.play(); 
} 
</script>

</body>
</html>